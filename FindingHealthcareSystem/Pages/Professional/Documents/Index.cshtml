@page "/professional/documents"
@model FindingHealthcareSystem.Pages.Professional.Documents.IndexModel
@using BusinessObjects.Enums
@{
    ViewData["Title"] = "Quản lý chứng chỉ";
}

<link rel="stylesheet" href="~/css/professional-documents.css">

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-certificate me-2"></i>Quản lý chứng chỉ hành nghề</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="fas fa-upload me-2"></i>Tải lên chứng chỉ
                </button>
            </div>

            <!-- Verification Status Summary -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="status-card total">
                        <div class="status-info">
                            <h3>@Model.Summary.TotalDocuments</h3>
                            <p>Tổng số chứng chỉ</p>
                        </div>
                        <i class="fas fa-file-medical"></i>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="status-card verified">
                        <div class="status-info">
                            <h3>@Model.Summary.VerifiedDocuments</h3>
                            <p>Đã xác thực</p>
                        </div>
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="status-card pending">
                        <div class="status-info">
                            <h3>@Model.Summary.PendingDocuments</h3>
                            <p>Chờ xác thực</p>
                        </div>
                        <i class="fas fa-clock"></i>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="status-card rejected">
                        <div class="status-info">
                            <h3>@Model.Summary.RejectedDocuments</h3>
                            <p>Bị từ chối</p>
                        </div>
                        <i class="fas fa-times-circle"></i>
                    </div>
                </div>
            </div>

            <!-- Missing Required Documents Alert -->
            @if (Model.Summary.MissingRequiredDocuments.Any())
            {
                <div class="alert alert-warning mb-4">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Thiếu chứng chỉ bắt buộc</h5>
                    <p>Bạn cần tải lên các chứng chỉ sau để hoàn tất hồ sơ:</p>
                    <ul class="mb-0">
                        @foreach (var missingDoc in Model.Summary.MissingRequiredDocuments)
                        {
                            <li>@missingDoc</li>
                        }
                    </ul>
                </div>
            }

            <!-- Documents List -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Danh sách chứng chỉ</h5>
                </div>
                <div class="card-body">
                    @if (!Model.Documents.Any())
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-file-upload fa-3x text-muted mb-3"></i>
                            <h5>Chưa có chứng chỉ nào</h5>
                            <p class="text-muted">Hãy tải lên chứng chỉ hành nghề của bạn để bắt đầu</p>
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                                Tải lên chứng chỉ đầu tiên
                            </button>
                        </div>
                    }
                    else
                    {
                        <div class="row">
                            @foreach (var document in Model.Documents)
                            {
                                <div class="col-lg-6 col-xl-4 mb-4">
                                    <div class="document-card">
                                        <div class="document-header">
                                            <div class="document-type">
                                                <i class="fas fa-certificate me-2"></i>
                                                @document.DocumentTypeName
                                            </div>
                                            <div class="document-status status-@document.VerificationStatus.ToString().ToLower()">
                                                @document.VerificationStatusName
                                            </div>
                                        </div>
                                        
                                        <div class="document-body">
                                            <h6 class="document-name">@document.DocumentName</h6>
                                            
                                            @if (!string.IsNullOrEmpty(document.DocumentNumber))
                                            {
                                                <p class="document-number">
                                                    <strong>Số hiệu:</strong> @document.DocumentNumber
                                                </p>
                                            }
                                            
                                            @if (document.IssueDate.HasValue)
                                            {
                                                <p class="document-date">
                                                    <strong>Ngày cấp:</strong> @document.IssueDate.Value.ToString("dd/MM/yyyy")
                                                </p>
                                            }
                                            
                                            @if (document.ExpiryDate.HasValue)
                                            {
                                                <p class="document-expiry @(document.IsExpiringSoon ? "text-warning" : "") @(document.IsExpired ? "text-danger" : "")">
                                                    <strong>Hết hạn:</strong> @document.ExpiryDate.Value.ToString("dd/MM/yyyy")
                                                    @if (document.IsExpiringSoon)
                                                    {
                                                        <i class="fas fa-exclamation-triangle ms-1" title="Sắp hết hạn"></i>
                                                    }
                                                    @if (document.IsExpired)
                                                    {
                                                        <i class="fas fa-times-circle ms-1" title="Đã hết hạn"></i>
                                                    }
                                                </p>
                                            }
                                            
                                            @if (!string.IsNullOrEmpty(document.IssuingAuthority))
                                            {
                                                <p class="document-authority">
                                                    <strong>Cơ quan cấp:</strong> @document.IssuingAuthority
                                                </p>
                                            }
                                        </div>
                                        
                                        <div class="document-footer">
                                            <div class="document-actions">
                                                <a href="@document.DocumentUrl" target="_blank" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye me-1"></i>Xem
                                                </a>
                                                @if (document.VerificationStatus == DocumentVerificationStatus.Rejected)
                                                {
                                                    <button class="btn btn-sm btn-primary" onclick="replaceDocument(@document.Id, '@document.DocumentType')">
                                                        <i class="fas fa-upload me-1"></i>Thay thế
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                        
                                        @if (document.VerificationStatus == DocumentVerificationStatus.Rejected && !string.IsNullOrEmpty(document.RejectionReason))
                                        {
                                            <div class="rejection-reason">
                                                <small class="text-danger">
                                                    <i class="fas fa-info-circle me-1"></i>
                                                    <strong>Lý do từ chối:</strong> @document.RejectionReason
                                                </small>
                                            </div>
                                        }
                                        
                                        @if (!string.IsNullOrEmpty(document.AdminNotes))
                                        {
                                            <div class="admin-notes">
                                                <small class="text-muted">
                                                    <i class="fas fa-comment me-1"></i>
                                                    <strong>Ghi chú:</strong> @document.AdminNotes
                                                </small>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Upload Document Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form id="uploadForm" method="post" enctype="multipart/form-data">
                <div class="modal-header">
                    <h5 class="modal-title">Tải lên chứng chỉ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Loại chứng chỉ <span class="text-danger">*</span></label>
                            <select name="DocumentType" class="form-select" required>
                                <option value="">Chọn loại chứng chỉ</option>
                                <option value="@DocumentType.MedicalDegree">Bằng tốt nghiệp bác sĩ</option>
                                <option value="@DocumentType.MedicalLicense">Giấy phép hành nghề</option>
                                <option value="@DocumentType.SpecialtyCertificate">Chứng chỉ chuyên khoa</option>
                                <option value="@DocumentType.PracticeCertificate">Chứng chỉ thực hành</option>
                                <option value="@DocumentType.IdentityDocument">Chứng minh thư/Căn cước</option>
                                <option value="@DocumentType.ContinuingEducationCertificate">Chứng chỉ đào tạo liên tục</option>
                                <option value="@DocumentType.Other">Khác</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Tên chứng chỉ <span class="text-danger">*</span></label>
                            <input type="text" name="DocumentName" class="form-control" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Số hiệu chứng chỉ</label>
                            <input type="text" name="DocumentNumber" class="form-control">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Cơ quan cấp</label>
                            <input type="text" name="IssuingAuthority" class="form-control">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ngày cấp</label>
                            <input type="date" name="IssueDate" class="form-control">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Ngày hết hạn</label>
                            <input type="date" name="ExpiryDate" class="form-control">
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">File chứng chỉ <span class="text-danger">*</span></label>
                            <input type="file" name="DocumentFile" class="form-control" accept=".pdf,.jpg,.jpeg,.png" required>
                            <div class="form-text">Chấp nhận định dạng: PDF, JPG, PNG. Tối đa 10MB.</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-upload me-2"></i>Tải lên
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="~/js/professional-documents.js"></script>
